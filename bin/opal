#!/usr/bin/env ruby

# Error codes are taken from /usr/include/sysexits.h

require 'opal/cli_options'
options = Opal::CLIOptions.new
begin
  options.parse!
rescue OptionParser::InvalidOption => e
  $stderr.puts "#{$0}: #{e.message} (-h will show valid options)"
  exit 64
end

require 'opal/cli'
cli = Opal::CLI.new options.options.merge(:file => ARGF)

begin
  cli.run
rescue Opal::CliRunners::RunnerError => e
  $stderr.puts e.message
  exit 72
end
